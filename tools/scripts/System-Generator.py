# This tool takes *.oil file generated by OSEK-Builder tool as input and 
# generates .c/.h/.mk files as output.
import sys
import os

from common import *
import utils

import colorama
from colorama import Fore, Back, Style



def print_usage(prog):
    print("Usage:\n\t python " + prog + " tools/oil-files/*.oil")


def main(of):
    oil_lines = of.readlines()
    for line in oil_lines:
        print(line)


if __name__ == '__main__':
    cmd_args = len(sys.argv)
    if cmd_args < 2:
        print(Fore.RED + "Error: Input OIL file not passed as argument!", Style.RESET_ALL)
        print_usage(sys.argv[0])
        exit(-1)
    
    # check and import pre-requisites
    utils.import_or_install("colorama")

    oilfile = sys.argv[1]
    print_info("Opening " + oilfile)
    if "oil" != oilfile.split(".")[-1]:
        print(Fore.RED + "Error: Input file is not an OIL file!", Style.RESET_ALL)
    
    if not os.path.exists(oilfile):
        print(Fore.RED + "Error: Can't open OIL file: \""+oilfile+"\"!", Style.RESET_ALL)
    else:
        of = open(oilfile, "r")
        print(Style.RESET_ALL, "\033[F")
        print_info("Parsing " + oilfile)
        main(of)
